<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0ì˜ ì§‘í–‰ - Choose Your Own Adventure (Improved)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            font-family: 'Segoe UI', 'Noto Sans CJK KR', sans-serif;
            height: 100%;
            overflow: hidden;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .vn-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #000;
        }

        /* í’€ìŠ¤í¬ë¦° ë°°ê²½ ì´ë¯¸ì§€ */
        .vn-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .vn-bg-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.8);
        }

        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .vn-header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vn-title {
            color: #fff;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .vn-progress-container {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .path-indicator {
            background: rgba(0,0,0,0.7);
            padding: 8px 15px;
            border-radius: 20px;
            color: #fff;
            font-size: 12px;
            border: 2px solid transparent;
        }

        .path-indicator.active {
            border-color: #00ff88;
            background: rgba(0,255,136,0.2);
        }

        .vn-menu-btn {
            background: rgba(0,0,0,0.8);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .vn-menu-btn:hover {
            background: rgba(0,255,136,0.8);
        }

        /* ëŒ€í™”ì°½ */
        .vn-dialogue-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.8) 100%);
            padding: 30px 40px;
            z-index: 5;
            min-height: 200px;
        }

        .vn-dialogue-text {
            color: #fff;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .vn-speaker {
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        /* ì„ íƒì§€ */
        .vn-choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .vn-choice {
            background: rgba(30, 30, 50, 0.9);
            border: 2px solid rgba(255,255,255,0.3);
            color: #fff;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            text-align: left;
        }

        .vn-choice:hover {
            background: rgba(0,255,136,0.3);
            border-color: #00ff88;
            transform: translateX(10px);
        }

        .choice-detective {
            border-left: 4px solid #4dabf7;
        }

        .choice-conspiracy {
            border-left: 4px solid #ff6b6b;
        }

        .choice-drama {
            border-left: 4px solid #ffd43b;
        }

        .choice-continue {
            background: rgba(0,255,136,0.2);
            border-color: #00ff88;
        }

        /* ê³„ì†í•˜ê¸° ë²„íŠ¼ */
        .vn-continue {
            background: rgba(0,255,136,0.2);
            border: 2px solid #00ff88;
            color: #00ff88;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px auto 0;
            display: block;
            transition: all 0.3s;
        }

        .vn-continue:hover {
            background: rgba(0,255,136,0.4);
            transform: scale(1.05);
        }

        /* ê²Œì„ ë©”ë‰´ */
        .vn-menu {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 15;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .menu-content {
            background: rgba(20,20,40,0.95);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #00ff88;
            text-align: center;
            min-width: 400px;
        }

        .menu-title {
            color: #00ff88;
            font-size: 24px;
            margin-bottom: 30px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .menu-btn {
            background: rgba(0,255,136,0.2);
            border: 2px solid #00ff88;
            color: #fff;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .menu-btn:hover {
            background: rgba(0,255,136,0.4);
        }

        .menu-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ê²½ë¡œ ì„ íƒ í™”ë©´ */
        .path-selection {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 20;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .path-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            max-width: 1000px;
            padding: 40px;
        }

        .path-card {
            background: rgba(20,20,40,0.9);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .path-card:hover {
            transform: translateY(-10px);
            border-color: #00ff88;
            background: rgba(0,255,136,0.1);
        }

        .path-card.completed {
            border-color: #ffd43b;
            background: rgba(255,212,59,0.1);
        }

        .path-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .path-title {
            color: #fff;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .path-desc {
            color: #ccc;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .path-status {
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 15px;
            margin-top: auto;
        }

        .status-new {
            background: rgba(0,255,136,0.2);
            color: #00ff88;
        }

        .status-playing {
            background: rgba(77,171,247,0.2);
            color: #4dabf7;
        }

        .status-completed {
            background: rgba(255,212,59,0.2);
            color: #ffd43b;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .vn-header {
                top: 10px;
                left: 10px;
                right: 10px;
            }

            .vn-title {
                font-size: 18px;
            }

            .vn-dialogue-container {
                padding: 20px;
                min-height: 180px;
            }

            .vn-dialogue-text {
                font-size: 16px;
            }

            .path-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .menu-content {
                padding: 30px 20px;
                min-width: 320px;
            }
        }
    </style>
</head>
<body>
    <div class="vn-container">
        <!-- ë°°ê²½ ì´ë¯¸ì§€ -->
        <div class="vn-background">
            <img id="vnBgImage" class="vn-bg-image" src="game/images/scenes/scene_01.png" alt="ë°°ê²½">
        </div>

        <!-- ìƒë‹¨ í—¤ë” -->
        <div class="vn-header">
            <div class="vn-title">0ì˜ ì§‘í–‰</div>
            <div class="vn-progress-container">
                <div class="path-indicator" id="detectiveIndicator">ğŸ” Detective</div>
                <div class="path-indicator" id="conspiracyIndicator">ğŸ•µï¸ Conspiracy</div>
                <div class="path-indicator" id="dramaIndicator">ğŸ’­ Drama</div>
                <button class="vn-menu-btn" onclick="showMenu()">ë©”ë‰´</button>
            </div>
        </div>

        <!-- ëŒ€í™”ì°½ -->
        <div class="vn-dialogue-container">
            <div class="vn-speaker" id="vnSpeaker">ì‹œì‘</div>
            <div class="vn-dialogue-text" id="vnDialogue">
                ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì„¸ ê°€ì§€ ë‹¤ë¥¸ ê²½ë¡œë¡œ ë¯¸ìŠ¤í„°ë¦¬ë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
            <div class="vn-choices" id="vnChoices"></div>
            <button class="vn-continue" id="vnContinue" onclick="nextDialogue()" style="display: none;">ê³„ì†í•˜ê¸°</button>
        </div>

        <!-- ê²Œì„ ë©”ë‰´ -->
        <div class="vn-menu" id="vnMenu">
            <div class="menu-content">
                <div class="menu-title">ê²Œì„ ë©”ë‰´</div>
                <div class="menu-buttons">
                    <button class="menu-btn" onclick="showPathSelection()">ê²½ë¡œ ì„ íƒ</button>
                    <button class="menu-btn" onclick="saveGame()">ê²Œì„ ì €ì¥</button>
                    <button class="menu-btn" onclick="loadGame()">ê²Œì„ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    <button class="menu-btn" onclick="resetGame()">ì²˜ìŒë¶€í„°</button>
                    <button class="menu-btn" onclick="hideMenu()">ëŒì•„ê°€ê¸°</button>
                </div>
            </div>
        </div>

        <!-- ê²½ë¡œ ì„ íƒ í™”ë©´ -->
        <div class="path-selection" id="pathSelection">
            <div class="path-grid">
                <div class="path-card" onclick="selectPath('detective')">
                    <div>
                        <div class="path-icon">ğŸ”</div>
                        <div class="path-title">Detective Path</div>
                        <div class="path-desc">ê³¼í•™ì  ë¶„ì„ê³¼ ë…¼ë¦¬ì  ì¶”ë¡ ìœ¼ë¡œ ì‚¬ê±´ì„ í•´ê²°í•˜ëŠ” í´ë˜ì‹ ë¯¸ìŠ¤í„°ë¦¬ ê²½ë¡œ</div>
                    </div>
                    <div class="path-status status-new" id="detective-status">ìƒˆë¡œ ì‹œì‘</div>
                </div>

                <div class="path-card" onclick="selectPath('conspiracy')">
                    <div>
                        <div class="path-icon">ğŸ•µï¸</div>
                        <div class="path-title">Conspiracy Path</div>
                        <div class="path-desc">ì •ë¶€-ê¸°ì—… ìŒëª¨ë¥¼ íŒŒí—¤ì¹˜ëŠ” ì •ì¹˜ ìŠ¤ë¦´ëŸ¬ ê²½ë¡œ</div>
                    </div>
                    <div class="path-status status-new" id="conspiracy-status">ìƒˆë¡œ ì‹œì‘</div>
                </div>

                <div class="path-card" onclick="selectPath('drama')">
                    <div>
                        <div class="path-icon">ğŸ’­</div>
                        <div class="path-title">Human Drama Path</div>
                        <div class="path-desc">ì¸ê°„ê´€ê³„ì™€ ê°ì •ì— ì§‘ì¤‘í•œ íœ´ë¨¼ ë“œë¼ë§ˆ ê²½ë¡œ</div>
                    </div>
                    <div class="path-status status-new" id="drama-status">ìƒˆë¡œ ì‹œì‘</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ ê´€ë¦¬
        let gameState = {
            currentDialogue: 0,
            selectedPath: null,
            subBranch: null,
            completedPaths: [],
            choices: {},
            unlockedScenes: []
        };

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê²Œì„ ìƒíƒœ ë¡œë“œ
        function loadGameState() {
            const saved = localStorage.getItem('mysteryGameState');
            if (saved) {
                gameState = { ...gameState, ...JSON.parse(saved) };
                updatePathIndicators();
            }
        }

        // ê²Œì„ ìƒíƒœ ì €ì¥
        function saveGameState() {
            localStorage.setItem('mysteryGameState', JSON.stringify(gameState));
        }

        // ëŒ€í™” ë°ì´í„°
        const dialogues = {
            common: [
                {
                    speaker: "ë‚˜ë ˆì´ì…˜",
                    text: "2045ë…„, ë„¤ì˜¤ ì„œìš¸. ì‚¬ì´ë²„ë³´ì•ˆ ì—°êµ¬ì†Œì—ì„œ ê°•ë°•ì‚¬ì˜ ì‹œì²´ê°€ ë°œê²¬ë˜ì—ˆë‹¤.",
                    image: "scene_01.png"
                },
                {
                    speaker: "ë‚˜ë ˆì´ì…˜",
                    text: "í˜„ì¥ì€ ë°€ì‹¤ì´ì—ˆê³ , ë¬¸ì€ ì•ˆìª½ì—ì„œ ì ê²¨ ìˆì—ˆë‹¤. í•˜ì§€ë§Œ ë­”ê°€ ì´ìƒí–ˆë‹¤.",
                    image: "scene_02.png"
                },
                {
                    speaker: "ë‚˜ë ˆì´ì…˜",
                    text: "ë‹¹ì‹ ì€ ì´ ì‚¬ê±´ì„ ì–´ë–»ê²Œ ì ‘ê·¼í•  ê²ƒì¸ê°€?",
                    image: "scene_03.png"
                },
                {
                    speaker: "ì„ íƒ",
                    text: "ìˆ˜ì‚¬ ë°©í–¥ì„ ì„ íƒí•˜ì„¸ìš”:",
                    image: "scene_04.png",
                    choices: [
                        "ğŸ” ê³¼í•™ì  ë¶„ì„ì„ í†µí•œ ë…¼ë¦¬ì  ìˆ˜ì‚¬",
                        "ğŸ•µï¸ ì •ë¶€ ê¸°ê´€ê³¼ì˜ ì—°ê´€ì„± ì¡°ì‚¬",
                        "ğŸ’­ ì¸ê°„ê´€ê³„ì™€ ë™ê¸° íŒŒì•…"
                    ],
                    choice_types: ['detective', 'conspiracy', 'drama']
                }
            ],

            detective: [
                {
                    speaker: "í˜•ì‚¬",
                    text: "ì¦ê±°ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ë¶„ì„í•´ë³´ì. í˜„ì¥ì—ì„œ ë°œê²¬ëœ ê²ƒë“¤ì„ ì‚´í´ë³´ë©´...",
                    image: "detective_01.png"
                },
                {
                    speaker: "í˜•ì‚¬",
                    text: "ê°•ë°•ì‚¬ì˜ ì—°êµ¬ ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?",
                    image: "detective_02.png",
                    choices: [
                        "ğŸ”¬ ì‹¤í—˜ì‹¤ ì»´í“¨í„° ì§ì ‘ ì¡°ì‚¬",
                        "ğŸ‘¥ ë™ë£Œë“¤ì—ê²Œ ë¨¼ì € ì§ˆë¬¸"
                    ],
                    choice_types: ['tech_route', 'social_route']
                },
                // ê¸°ìˆ  ê²½ë¡œ
                {
                    speaker: "í˜•ì‚¬",
                    text: "ì»´í“¨í„°ì—ì„œ ì•”í˜¸í™”ëœ íŒŒì¼ì„ ë°œê²¬í–ˆë‹¤. í•´ë…í•´ë³´ì.",
                    image: "detective_03.png",
                    branch: "tech_route"
                },
                {
                    speaker: "AI",
                    text: "íŒŒì¼ ë¶„ì„ ê²°ê³¼, ê°•ë°•ì‚¬ê°€ ìœ„í—˜í•œ ì—°êµ¬ë¥¼ í•˜ê³  ìˆì—ˆë‹¤ëŠ” ì¦ê±°ê°€ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤.",
                    image: "detective_04.png",
                    branch: "tech_route"
                },
                // ì‚¬íšŒì  ê²½ë¡œ
                {
                    speaker: "ë™ë£Œ",
                    text: "ê°•ë°•ì‚¬ëŠ” ìµœê·¼ ëˆ„êµ°ê°€ë¥¼ ë§¤ìš° ê²½ê³„í•˜ê³  ìˆì—ˆì–´ìš”. ë¬´ì„œì›Œí•˜ëŠ” ê²ƒ ê°™ì•˜ìŠµë‹ˆë‹¤.",
                    image: "detective_05.png",
                    branch: "social_route"
                },
                {
                    speaker: "í˜•ì‚¬",
                    text: "ëˆ„êµ¬ë¥¼ ê²½ê³„í–ˆëŠ”ì§€ ë” ìì„¸íˆ ì•Œì•„ë´ì•¼ê² ë‹¤.",
                    image: "detective_06.png",
                    branch: "social_route"
                },
                // ê³µí†µ ì§„í–‰
                {
                    speaker: "ë‚˜ë ˆì´ì…˜",
                    text: "ë‘ ê²½ë¡œì—ì„œ ì–»ì€ ì •ë³´ë¥¼ ì¢…í•©í•´ë³´ë©´...",
                    image: "detective_07.png"
                },
                {
                    speaker: "í˜•ì‚¬",
                    text: "ì§„ì‹¤ì— í•œ ê±¸ìŒ ë” ë‹¤ê°€ê°”ë‹¤. ì´ì œ ìµœì¢… ì¶”ë¡ ì„ í•´ë³´ì.",
                    image: "detective_08.png"
                },
                {
                    speaker: "ê²°ë§",
                    text: "Detective Path ì™„ë£Œ! ë…¼ë¦¬ì™€ ê³¼í•™ìœ¼ë¡œ ì‚¬ê±´ì„ í•´ê²°í–ˆìŠµë‹ˆë‹¤.",
                    image: "detective_09.png"
                }
            ],

            conspiracy: [
                {
                    speaker: "ë‚´ë¶€ê³ ë°œì",
                    text: "ì´ê²ƒì€ ë‹¨ìˆœí•œ ì‚´ì¸ì´ ì•„ë‹™ë‹ˆë‹¤. ê±°ëŒ€í•œ ìŒëª¨ì˜ ì¼ë¶€ì—ìš”.",
                    image: "conspiracy_01.png"
                },
                {
                    speaker: "ê¸°ì",
                    text: "ì–´ë–»ê²Œ ì§„ì‹¤ì— ì ‘ê·¼í•  ê²ƒì¸ê°€?",
                    image: "conspiracy_02.png",
                    choices: [
                        "ğŸ¢ ì •ë¶€ ê¸°ê´€ ì¹¨íˆ¬",
                        "ğŸ“± í•´í‚¹ìœ¼ë¡œ ì •ë³´ ìˆ˜ì§‘"
                    ],
                    choice_types: ['infiltration_route', 'hacking_route']
                },
                // ì¹¨íˆ¬ ê²½ë¡œ
                {
                    speaker: "ê¸°ì",
                    text: "ì •ë¶€ ê±´ë¬¼ì— ì ì…í–ˆë‹¤. ìœ„í—˜í•˜ì§€ë§Œ ì§ì ‘ í™•ì¸í•´ì•¼ í•œë‹¤.",
                    image: "conspiracy_03.png",
                    branch: "infiltration_route"
                },
                {
                    speaker: "ìš”ì›",
                    text: "ë‹¹ì‹ ì´ ì—¬ê¸°ì„œ ë­˜ í•˜ê³  ìˆëŠ” ê±°ì£ ?",
                    image: "conspiracy_04.png",
                    branch: "infiltration_route"
                },
                // í•´í‚¹ ê²½ë¡œ
                {
                    speaker: "í•´ì»¤",
                    text: "ì‹œìŠ¤í…œì— ì ‘ê·¼í–ˆìŠµë‹ˆë‹¤. ë†€ë¼ìš´ ì •ë³´ë“¤ì´ ë‚˜ì˜¤ê³  ìˆì–´ìš”.",
                    image: "conspiracy_05.png",
                    branch: "hacking_route"
                },
                {
                    speaker: "ê¸°ì",
                    text: "ì´ ì •ë³´ê°€ ì‚¬ì‹¤ì´ë¼ë©´... ì¶©ê²©ì ì´ë‹¤.",
                    image: "conspiracy_06.png",
                    branch: "hacking_route"
                },
                // ê³µí†µ ì§„í–‰
                {
                    speaker: "ë‚˜ë ˆì´ì…˜",
                    text: "ê±°ëŒ€í•œ ìŒëª¨ì˜ ì „ì²´ ê·¸ë¦¼ì´ ë“œëŸ¬ë‚˜ê¸° ì‹œì‘í–ˆë‹¤.",
                    image: "conspiracy_07.png"
                },
                {
                    speaker: "ê¸°ì",
                    text: "ì´ì œ ì„¸ìƒì— ì§„ì‹¤ì„ ì•Œë ¤ì•¼ í•œë‹¤.",
                    image: "conspiracy_08.png"
                },
                {
                    speaker: "ê²°ë§",
                    text: "Conspiracy Path ì™„ë£Œ! ê±°ëŒ€í•œ ìŒëª¨ë¥¼ í­ë¡œí–ˆìŠµë‹ˆë‹¤.",
                    image: "conspiracy_09.png"
                }
            ],

            drama: [
                {
                    speaker: "ìœ ì§€ë¯¼",
                    text: "ê°•ë°•ì‚¬ëŠ”... ì œ ìŠ¤ìŠ¹ì´ì—ˆì–´ìš”. ì´í•´í•  ìˆ˜ ì—†ì–´ìš”.",
                    image: "drama_01.png"
                },
                {
                    speaker: "í•œê¸°íƒœ",
                    text: "ìš°ë¦¬ëŠ” ì„œë¡œë¥¼ ì–´ë–»ê²Œ ëŒ€í•´ì•¼ í• ê¹Œìš”?",
                    image: "drama_02.png",
                    choices: [
                        "â¤ï¸ ê°ì •ì ìœ¼ë¡œ ì ‘ê·¼",
                        "ğŸ¤ ì´ì„±ì ìœ¼ë¡œ ì ‘ê·¼"
                    ],
                    choice_types: ['emotional_route', 'rational_route']
                },
                // ê°ì • ê²½ë¡œ
                {
                    speaker: "ìœ ì§€ë¯¼",
                    text: "ëª¨ë“  ê²Œ ë¬´ë„ˆì§€ëŠ” ê²ƒ ê°™ì•„ìš”. ë¯¿ì—ˆë˜ ê²ƒë“¤ì´...",
                    image: "drama_03.png",
                    branch: "emotional_route"
                },
                {
                    speaker: "í•œê¸°íƒœ",
                    text: "ê´œì°®ì•„ìš”. ìš°ë¦¬ê°€ í•¨ê»˜ ì´ê²¨ë‚¼ ìˆ˜ ìˆì–´ìš”.",
                    image: "drama_04.png",
                    branch: "emotional_route"
                },
                // ì´ì„± ê²½ë¡œ
                {
                    speaker: "í•œê¸°íƒœ",
                    text: "ê°ì •ì„ ì œì³ë‘ê³  ë…¼ë¦¬ì ìœ¼ë¡œ ìƒê°í•´ë´…ì‹œë‹¤.",
                    image: "drama_05.png",
                    branch: "rational_route"
                },
                {
                    speaker: "ìœ ì§€ë¯¼",
                    text: "ë„¤, ë§ì•„ìš”. ê°•ë°•ì‚¬ê°€ ì›í–ˆë˜ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?",
                    image: "drama_06.png",
                    branch: "rational_route"
                },
                // ê³µí†µ ì§„í–‰
                {
                    speaker: "ë‚˜ë ˆì´ì…˜",
                    text: "ë‘ ì‚¬ëŒì€ ì„œë¡œë¥¼ ì´í•´í•˜ê¸° ì‹œì‘í–ˆë‹¤.",
                    image: "drama_07.png"
                },
                {
                    speaker: "ìœ ì§€ë¯¼",
                    text: "ì´ì œ ì•ìœ¼ë¡œ ë‚˜ì•„ê°ˆ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”.",
                    image: "drama_08.png"
                },
                {
                    speaker: "ê²°ë§",
                    text: "Human Drama Path ì™„ë£Œ! ì¸ê°„ê´€ê³„ì˜ ì¹˜ìœ ë¥¼ ì´ë¤„ëƒˆìŠµë‹ˆë‹¤.",
                    image: "drama_09.png"
                }
            ]
        };

        // ê²½ë¡œ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
        function updatePathIndicators() {
            ['detective', 'conspiracy', 'drama'].forEach(path => {
                const indicator = document.getElementById(path + 'Indicator');
                const status = document.getElementById(path + '-status');

                if (gameState.completedPaths.includes(path)) {
                    indicator.classList.add('active');
                    if (status) {
                        status.textContent = 'ì™„ë£Œ';
                        status.className = 'path-status status-completed';
                    }
                } else if (gameState.selectedPath === path) {
                    indicator.classList.add('active');
                    if (status) {
                        status.textContent = 'ì§„í–‰ì¤‘';
                        status.className = 'path-status status-playing';
                    }
                } else {
                    indicator.classList.remove('active');
                    if (status) {
                        status.textContent = 'ìƒˆë¡œ ì‹œì‘';
                        status.className = 'path-status status-new';
                    }
                }
            });
        }

        // ëŒ€í™” í‘œì‹œ
        function showDialogue() {
            let currentData;

            if (gameState.selectedPath === null) {
                // ê³µí†µ ì‹œì‘ ë¶€ë¶„
                currentData = dialogues.common[gameState.currentDialogue];
            } else {
                // ì„ íƒëœ ê²½ë¡œì˜ ëŒ€í™”
                const pathDialogues = dialogues[gameState.selectedPath];
                const adjustedIndex = gameState.currentDialogue - dialogues.common.length;
                currentData = pathDialogues[adjustedIndex];

                // ë¸Œëœì¹˜ í•„í„°ë§
                if (currentData && currentData.branch && gameState.subBranch !== currentData.branch) {
                    nextDialogue();
                    return;
                }
            }

            if (!currentData) {
                endGame();
                return;
            }

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('vnSpeaker').textContent = currentData.speaker;
            document.getElementById('vnDialogue').textContent = currentData.text;
            document.getElementById('vnBgImage').src = `game/images/scenes/${currentData.image}`;

            // ì„ íƒì§€ í‘œì‹œ
            const choicesContainer = document.getElementById('vnChoices');
            const continueBtn = document.getElementById('vnContinue');

            choicesContainer.innerHTML = '';

            if (currentData.choices) {
                continueBtn.style.display = 'none';
                currentData.choices.forEach((choice, index) => {
                    const btn = document.createElement('button');
                    btn.className = `vn-choice choice-${currentData.choice_types[index]}`;
                    btn.textContent = choice;
                    btn.onclick = () => makeChoice(index, currentData.choice_types);
                    choicesContainer.appendChild(btn);
                });
            } else {
                continueBtn.style.display = 'block';
                continueBtn.textContent = gameState.currentDialogue >= getTotalDialogues() - 1 ? 'ì™„ë£Œ' : 'ê³„ì†í•˜ê¸°';
            }

            saveGameState();
        }

        // ì„ íƒì§€ ì²˜ë¦¬
        function makeChoice(choiceIndex, choiceTypes) {
            const choiceType = choiceTypes[choiceIndex];

            if (gameState.selectedPath === null) {
                // ê²½ë¡œ ì„ íƒ
                gameState.selectedPath = choiceType;
                gameState.currentDialogue = dialogues.common.length;
            } else {
                // ì„œë¸Œ ë¸Œëœì¹˜ ì„ íƒ
                gameState.subBranch = choiceType;
                gameState.currentDialogue++;
            }

            gameState.choices[gameState.currentDialogue] = choiceIndex;
            updatePathIndicators();
            showDialogue();
        }

        // ë‹¤ìŒ ëŒ€í™”ë¡œ
        function nextDialogue() {
            gameState.currentDialogue++;
            showDialogue();
        }

        // ì´ ëŒ€í™” ìˆ˜ ê³„ì‚°
        function getTotalDialogues() {
            if (gameState.selectedPath === null) {
                return dialogues.common.length;
            }
            return dialogues.common.length + dialogues[gameState.selectedPath].length;
        }

        // ê²Œì„ ì¢…ë£Œ
        function endGame() {
            if (gameState.selectedPath && !gameState.completedPaths.includes(gameState.selectedPath)) {
                gameState.completedPaths.push(gameState.selectedPath);
            }

            const continueBtn = document.getElementById('vnContinue');
            continueBtn.textContent = 'ë‹¤ë¥¸ ê²½ë¡œ í”Œë ˆì´';
            continueBtn.onclick = () => showPathSelection();
            continueBtn.style.display = 'block';

            updatePathIndicators();
            saveGameState();
        }

        // ë©”ë‰´ í‘œì‹œ/ìˆ¨ê¸°ê¸°
        function showMenu() {
            document.getElementById('vnMenu').style.display = 'flex';
        }

        function hideMenu() {
            document.getElementById('vnMenu').style.display = 'none';
        }

        // ê²½ë¡œ ì„ íƒ í™”ë©´
        function showPathSelection() {
            document.getElementById('pathSelection').style.display = 'flex';
            hideMenu();
            updatePathIndicators();
        }

        function selectPath(path) {
            gameState.selectedPath = path;
            gameState.currentDialogue = dialogues.common.length;
            gameState.subBranch = null;

            document.getElementById('pathSelection').style.display = 'none';
            updatePathIndicators();
            showDialogue();
        }

        // ê²Œì„ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
        function saveGame() {
            saveGameState();
            alert('ê²Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            hideMenu();
        }

        function loadGame() {
            loadGameState();
            showDialogue();
            alert('ê²Œì„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
            hideMenu();
        }

        function resetGame() {
            if (confirm('ì •ë§ë¡œ ì²˜ìŒë¶€í„° ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                gameState = {
                    currentDialogue: 0,
                    selectedPath: null,
                    subBranch: null,
                    completedPaths: [],
                    choices: {},
                    unlockedScenes: []
                };
                localStorage.removeItem('mysteryGameState');
                updatePathIndicators();
                showDialogue();
                hideMenu();
            }
        }

        // ê²Œì„ ì´ˆê¸°í™”
        function initGame() {
            loadGameState();
            updatePathIndicators();
            showDialogue();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²Œì„ ì‹œì‘
        window.onload = initGame;
    </script>
</body>
</html>